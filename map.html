<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <title>å°ç£é„‰é®å¸‚å€è·¯æ®ºåœ°åœ–</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
    body {
        font-family: sans-serif;
        margin: 0;
        padding: 0;
    }

    #tooltip {
        position: absolute;
        background-color: rgba(255, 255, 255, 0.9);
        padding: 10px;
        border: 1px solid #999;
        border-radius: 6px;
        pointer-events: none;
        display: none;
        max-width: 250px;
    }

    .legend {
        font-size: 12px;
    }

    svg {
        display: block;
        margin: auto;
        background: #f5f5f5;
    }

    .district {
        stroke: #ccc;
        stroke-width: 0.5;
        cursor: pointer;
        transition: transform 0.2s ease-out;
    }

    .district:hover {
        transform: scale(1.02);
        stroke: #333;
        stroke-width: 1.5;
    }
    </style>
</head>

<body>
    <h2 style="text-align:center">å…¨å°ç£é„‰é®å¸‚å€è·¯æ®ºåœ°åœ–</h2>
    <div id="tooltip"></div>
    <svg width="900" height="1000"></svg>
    <script>
    const width = 900,
        height = 1000;

    const svg = d3.select("svg");

    const tooltip = d3.select("#tooltip");

    // ğŸ“Š è·¯æ®ºæ•¸æ“š
    const roadkillCounts = new Map([
        ["å½°åŒ–ç¸£èŠ³è‹‘é„‰", 3707],
        ["å°å—å¸‚æŸ³ç‡Ÿå€", 3692],
        ["é«˜é›„å¸‚ç‡•å·¢å€", 3395],
        ["å°å—å¸‚ç™½æ²³å€", 2955],
        ["è‹—æ —ç¸£é€šéœ„é®", 2922],
        ["é«˜é›„å¸‚å²¡å±±å€", 2837],
        ["å°å—å¸‚å®˜ç”°å€", 2724],
        ["å°åŒ—å¸‚åŒ—æŠ•å€", 2634],
        ["å—æŠ•ç¸£ç«¹å±±é®", 2584]
    ]);

    // ğŸ¾ å‰5å¤§ç‰©ç¨®è³‡æ–™ï¼ˆåœ°é»å°æ‡‰é™£åˆ—ï¼‰
    const topSpecies = {
        "é«˜é›„å¸‚é¼“å±±å€": [
            "é»‘çœ¶èŸ¾èœ Duttaphrynus melanostictus - 19",
            "äºæ´²éŒ¦è›™ Kaloula pulchra - 11",
            "èµ¤è…¹æ¾é¼  Callosciurus erythraeus thaiwanensis - 11",
            "å¤šç·šçœŸç¨œèœ¥ Eutropis multifasciata - 10",
            "èœ¥è™å±¬ Hemidactylus - 10"
        ],
        "å°æ±ç¸£å¤ªéº»é‡Œé„‰": [
            "é¼¬ç¾ - 51",
            "ç™½é¼»å¿ƒ - 16",
            "è‡ºç£å±±ç¾Œ Muntiacus reevesi micrurus - 13",
            "é´¿å­ - 13",
            "ç‹— - 12"
        ]
    };

    // è‰²å½©æ¯”ä¾‹å°º
    const colorScale = d3.scaleSequential()
        .domain([0, d3.max(Array.from(roadkillCounts.values()))])
        .interpolator(d3.interpolateOrRd);

    // è¼‰å…¥ GeoJSON
    d3.json("districts-mercator-10t.json").then(geoData => {
        const projection = d3.geoIdentity().reflectY(true).fitSize([width, height], geoData);
        const path = d3.geoPath().projection(projection);

        svg.selectAll("path")
            .data(geoData.features)
            .enter()
            .append("path")
            .attr("class", "district")
            .attr("d", path)
            .attr("fill", d => {
                const name = d.properties.COUNTYNAME + d.properties.TOWNNAME;
                const count = roadkillCounts.get(name) || 0;
                return count > 0 ? colorScale(count) : "#eee";
            })
            .on("mouseover", (event, d) => {
                const name = d.properties.COUNTYNAME + d.properties.TOWNNAME;
                const count = roadkillCounts.get(name) || 0;
                tooltip
                    .style("left", (event.pageX + 10) + "px")
                    .style("top", (event.pageY - 40) + "px")
                    .style("display", "block")
                    .html(`<strong>${name}</strong><br/>è·¯æ®ºæ•¸é‡ï¼š${count}`);
            })
            .on("mouseout", () => {
                tooltip.style("display", "none");
            })
            .on("click", (event, d) => {
                const name = d.properties.COUNTYNAME + d.properties.TOWNNAME;
                const speciesList = topSpecies[name];
                if (speciesList) {
                    tooltip.html(`<strong>${name}</strong><br/>è·¯æ®ºæ•¸é‡ï¼š${roadkillCounts.get(name) || 0}<br/><br/>å‰äº”åç‰©ç¨®ï¼š<ul>` +
                        speciesList.map(s => `<li>${s}</li>`).join("") + "</ul>");
                }
            });

        // ğŸ¨ åŠ ä¸Šåœ–ä¾‹
        const legendHeight = 200;
        const legendWidth = 20;

        const legendSvg = svg.append("g")
            .attr("transform", `translate(${width - 80}, ${height - legendHeight - 50})`);

        const legendScale = d3.scaleLinear()
            .domain(colorScale.domain())
            .range([legendHeight, 0]);

        const legendAxis = d3.axisRight(legendScale)
            .ticks(5);

        // è‰²æ¢æ¼¸å±¤
        const legendGradient = legendSvg.append("defs")
            .append("linearGradient")
            .attr("id", "legend-gradient")
            .attr("x1", "0%").attr("y1", "100%")
            .attr("x2", "0%").attr("y2", "0%");

        const n = 10;
        for (let i = 0; i <= n; i++) {
            legendGradient.append("stop")
                .attr("offset", `${(i / n) * 100}%`)
                .attr("stop-color", colorScale((i / n) * colorScale.domain()[1]));
        }

        legendSvg.append("rect")
            .attr("width", legendWidth)
            .attr("height", legendHeight)
            .style("fill", "url(#legend-gradient)");

        legendSvg.append("g")
            .attr("transform", `translate(${legendWidth}, 0)`)
            .call(legendAxis);

        legendSvg.append("text")
            .attr("x", -10)
            .attr("y", -10)
            .attr("text-anchor", "start")
            .text("è·¯æ®ºæ•¸é‡")
            .style("font-size", "12px");
    });
    </script>
</body>

</html>